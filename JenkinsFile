pipeline {
  agent{
    docker {
      image 'maven:3-alpine'
      args '-v /root/.m2:/root/.m2'
      }
     }
     
     stages{
       stage('Build'){
        steps{
           sh 'mvn -B -DskipTests clean package'
        }  
       }
        stage('Test'){
         steps{
           sh 'mvn test'
           }
        } 
        stage('SonarQube analysis') {
       steps{
              withSonarQubeEnv(credentialsId: '7bb1fa4dc506ecf751127b1410c70badb0e298a9', installationName: 'My SonarQube Server') 
      { 
       // You can override the credential to be used
         sh 'mvn verify org.sonarsource.scanner.maven:sonar-maven-plugin:sonar'
      }
    }
  }
      }
     }
